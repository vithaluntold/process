<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EPI X-Ray Agent</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #1e3a8a 0%, #0c4a6e 100%);
      color: #fff;
      padding: 20px;
      overflow-x: hidden;
    }

    .container {
      max-width: 500px;
      margin: 0 auto;
    }

    h1 {
      font-size: 24px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo {
      width: 32px;
      height: 32px;
      background: #22d3ee;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    .subtitle {
      color: rgba(255, 255, 255, 0.7);
      margin-bottom: 30px;
    }

    .status-card {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      backdrop-filter: blur(10px);
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }

    .indicator-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #ef4444;
    }

    .indicator-dot.active {
      background: #22c55e;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 15px;
    }

    .stat-item {
      background: rgba(255, 255, 255, 0.05);
      padding: 10px;
      border-radius: 8px;
    }

    .stat-label {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.6);
      margin-bottom: 4px;
    }

    .stat-value {
      font-size: 20px;
      font-weight: bold;
    }

    .btn {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 10px;
    }

    .btn-primary {
      background: #22d3ee;
      color: #1e3a8a;
    }

    .btn-primary:hover {
      background: #06b6d4;
      transform: translateY(-1px);
    }

    .btn-danger {
      background: #ef4444;
      color: #fff;
    }

    .btn-danger:hover {
      background: #dc2626;
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.15);
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-label {
      display: block;
      margin-bottom: 6px;
      font-size: 14px;
      color: rgba(255, 255, 255, 0.9);
    }

    .form-input {
      width: 100%;
      padding: 10px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 6px;
      background: rgba(255, 255, 255, 0.05);
      color: #fff;
      font-size: 14px;
    }

    .form-input:focus {
      outline: none;
      border-color: #22d3ee;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }

    .checkbox-group input[type="checkbox"] {
      width: 18px;
      height: 18px;
    }

    .checkbox-group label {
      font-size: 14px;
    }

    .tab-nav {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .tab-btn {
      flex: 1;
      padding: 10px;
      border: none;
      background: rgba(255, 255, 255, 0.1);
      color: rgba(255, 255, 255, 0.6);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .tab-btn.active {
      background: rgba(34, 211, 238, 0.2);
      color: #22d3ee;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .activity-feed {
      max-height: 200px;
      overflow-y: auto;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      padding: 10px;
    }

    .activity-item {
      font-size: 12px;
      padding: 6px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .activity-item:last-child {
      border-bottom: none;
    }

    .alert {
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 15px;
      font-size: 14px;
    }

    .alert-success {
      background: rgba(34, 197, 94, 0.2);
      border: 1px solid rgba(34, 197, 94, 0.3);
    }

    .alert-error {
      background: rgba(239, 68, 68, 0.2);
      border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>
      <div class="logo">X</div>
      EPI X-Ray Agent
    </h1>
    <p class="subtitle">Desktop Activity Capture & Analysis</p>

    <div id="alert" class="alert hidden"></div>

    <div class="tab-nav">
      <button class="tab-btn active" onclick="showTab('status')">Status</button>
      <button class="tab-btn" onclick="showTab('settings')">Settings</button>
    </div>

    <div id="status-tab" class="tab-content active">
      <div class="status-card">
        <div class="status-indicator">
          <div id="status-dot" class="indicator-dot"></div>
          <div>
            <strong id="status-text">Tracking Paused</strong>
            <div class="subtitle" style="font-size: 12px;">Ready to capture activities</div>
          </div>
        </div>

        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-label">Keystrokes</div>
            <div class="stat-value" id="stat-keystrokes">0</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">App Switches</div>
            <div class="stat-value" id="stat-apps">0</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Screenshots</div>
            <div class="stat-value" id="stat-screenshots">0</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Duration</div>
            <div class="stat-value" id="stat-duration">0m</div>
          </div>
        </div>
      </div>

      <button id="start-btn" class="btn btn-primary" onclick="toggleTracking()">
        Start Tracking
      </button>

      <div class="status-card">
        <h3 style="margin-bottom: 10px; font-size: 16px;">Recent Activities</h3>
        <div id="activity-feed" class="activity-feed">
          <div style="text-align: center; color: rgba(255,255,255,0.5); padding: 20px;">
            No activities yet
          </div>
        </div>
      </div>
    </div>

    <div id="settings-tab" class="tab-content">
      <div class="status-card">
        <h3 style="margin-bottom: 15px; font-size: 16px;">Connection Settings</h3>
        
        <div class="form-group">
          <label class="form-label">Platform URL</label>
          <input type="text" id="platform-url" class="form-input" placeholder="http://localhost:5000">
        </div>

        <div class="form-group">
          <label class="form-label">API Key</label>
          <input type="password" id="api-key" class="form-input" placeholder="Your API key">
        </div>

        <div class="form-group">
          <label class="form-label">User ID</label>
          <input type="text" id="user-id" class="form-input" placeholder="Your user ID">
        </div>

        <button class="btn btn-secondary" onclick="testConnection()">Test Connection</button>
      </div>

      <div class="status-card">
        <h3 style="margin-bottom: 15px; font-size: 16px;">Capture Settings</h3>
        
        <div class="checkbox-group">
          <input type="checkbox" id="capture-keyboard" checked>
          <label for="capture-keyboard">Capture Keyboard Activity</label>
        </div>

        <div class="checkbox-group">
          <input type="checkbox" id="capture-apps" checked>
          <label for="capture-apps">Track Application Usage</label>
        </div>

        <div class="checkbox-group">
          <input type="checkbox" id="capture-screenshots">
          <label for="capture-screenshots">Capture Screenshots</label>
        </div>

        <div class="form-group">
          <label class="form-label">Screenshot Interval (seconds)</label>
          <input type="number" id="screenshot-interval" class="form-input" value="60" min="10">
        </div>
      </div>

      <div class="status-card">
        <h3 style="margin-bottom: 15px; font-size: 16px;">Privacy Settings</h3>
        
        <div class="checkbox-group">
          <input type="checkbox" id="encrypt-data">
          <label for="encrypt-data">Encrypt Data (AES-256 - Advanced)</label>
        </div>
        <p style="font-size: 11px; color: rgba(255,255,255,0.6); margin-left: 26px; margin-top: -8px;">
          Note: Keep disabled unless you've configured server-side decryption
        </p>

        <div class="checkbox-group">
          <input type="checkbox" id="blur-sensitive" checked>
          <label for="blur-sensitive">Blur Sensitive Information</label>
        </div>

        <div class="checkbox-group">
          <input type="checkbox" id="privacy-consent">
          <label for="privacy-consent">I consent to activity tracking</label>
        </div>

        <div class="checkbox-group">
          <input type="checkbox" id="auto-start">
          <label for="auto-start">Start tracking on launch</label>
        </div>
      </div>

      <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
    </div>
  </div>

  <script>
    let tracking = false;
    let statsInterval;

    async function loadConfig() {
      const config = await window.agentAPI.getConfig();
      
      document.getElementById('platform-url').value = config.platformUrl || '';
      document.getElementById('api-key').value = config.apiKey || '';
      document.getElementById('user-id').value = config.userId || '';
      document.getElementById('capture-keyboard').checked = config.captureKeyboard;
      document.getElementById('capture-apps').checked = config.captureApplications;
      document.getElementById('capture-screenshots').checked = config.captureScreenshots;
      document.getElementById('screenshot-interval').value = config.screenshotInterval / 1000;
      document.getElementById('encrypt-data').checked = config.encryptData;
      document.getElementById('blur-sensitive').checked = config.blurSensitiveData;
      document.getElementById('privacy-consent').checked = config.privacyConsent;
      document.getElementById('auto-start').checked = config.autoStart;
    }

    async function saveSettings() {
      const config = {
        platformUrl: document.getElementById('platform-url').value,
        apiKey: document.getElementById('api-key').value,
        userId: document.getElementById('user-id').value,
        captureKeyboard: document.getElementById('capture-keyboard').checked,
        captureApplications: document.getElementById('capture-apps').checked,
        captureScreenshots: document.getElementById('capture-screenshots').checked,
        screenshotInterval: parseInt(document.getElementById('screenshot-interval').value) * 1000,
        encryptData: document.getElementById('encrypt-data').checked,
        blurSensitiveData: document.getElementById('blur-sensitive').checked,
        privacyConsent: document.getElementById('privacy-consent').checked,
        autoStart: document.getElementById('auto-start').checked,
      };

      await window.agentAPI.saveConfig(config);
      showAlert('Settings saved successfully', 'success');
    }

    async function toggleTracking() {
      if (tracking) {
        await window.agentAPI.stopTracking();
      } else {
        await window.agentAPI.startTracking();
      }
    }

    async function testConnection() {
      const result = await window.agentAPI.testConnection();
      showAlert(result.message, result.success ? 'success' : 'error');
    }

    async function updateStats() {
      const status = await window.agentAPI.getStatus();
      tracking = status.tracking;

      document.getElementById('status-dot').className = 
        'indicator-dot' + (tracking ? ' active' : '');
      document.getElementById('status-text').textContent = 
        tracking ? 'Tracking Active' : 'Tracking Paused';
      document.getElementById('start-btn').textContent = 
        tracking ? 'Stop Tracking' : 'Start Tracking';
      document.getElementById('start-btn').className = 
        'btn ' + (tracking ? 'btn-danger' : 'btn-primary');

      if (status.stats) {
        document.getElementById('stat-keystrokes').textContent = 
          status.stats.keystrokes.toLocaleString();
        document.getElementById('stat-apps').textContent = 
          status.stats.appSwitches.toLocaleString();
        document.getElementById('stat-screenshots').textContent = 
          status.stats.screenshots.toLocaleString();
        
        const duration = Math.floor(status.stats.duration / 60000);
        document.getElementById('stat-duration').textContent = duration + 'm';
      }
    }

    function showTab(tab) {
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });

      event.target.classList.add('active');
      document.getElementById(tab + '-tab').classList.add('active');
    }

    function showAlert(message, type) {
      const alert = document.getElementById('alert');
      alert.textContent = message;
      alert.className = 'alert alert-' + type;
      
      setTimeout(() => {
        alert.classList.add('hidden');
      }, 3000);
    }

    window.agentAPI.onActivityLogged((activity) => {
      const feed = document.getElementById('activity-feed');
      const item = document.createElement('div');
      item.className = 'activity-item';
      item.textContent = `${new Date(activity.timestamp).toLocaleTimeString()} - ${activity.type}`;
      
      if (feed.children.length === 0 || feed.children[0].textContent.includes('No activities')) {
        feed.innerHTML = '';
      }
      
      feed.insertBefore(item, feed.firstChild);
      
      if (feed.children.length > 20) {
        feed.removeChild(feed.lastChild);
      }
    });

    window.agentAPI.onError((message) => {
      showAlert(message, 'error');
    });

    window.agentAPI.onShowSettings(() => {
      showTab('settings');
    });

    loadConfig();
    updateStats();
    statsInterval = setInterval(updateStats, 2000);
  </script>
</body>
</html>
